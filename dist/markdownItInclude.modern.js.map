{"version":3,"file":"markdownItInclude.modern.js","sources":["../index.js"],"sourcesContent":["const path = require('path');\nconst fs = require('fs');\n\nconst INCLUDE_RE = /\\n(\\s*)#include\\s(.+)/;\n\nconst include_plugin = (md, options) => {\n  const defaultOptions = {\n    root: '.',\n    getRootDir: (pluginOptions /*, state, startLine, endLine*/) =>\n      pluginOptions.root,\n    includeRe: INCLUDE_RE,\n    throwError: true,\n    bracesAreOptional: false,\n    notFoundMessage: 'File {{FILE}} not found.',\n    circularMessage: 'Circular reference between {{FILE}} and {{PARENT}}'\n  };\n\n  if (typeof options === 'string') {\n    options = {\n      ...defaultOptions,\n      root: options\n    };\n  } else {\n    options = {\n      ...defaultOptions,\n      ...options\n    };\n  }\n\n  const _replaceIncludeByContent = (\n    src,\n    rootdir,\n    parentFilePath,\n    filesProcessed\n  ) => {\n    filesProcessed = filesProcessed ? filesProcessed.slice() : []; // making a copy\n    let cap, filePath, mdSrc, errorMessage;\n\n    // store parent file path to check circular references\n    if (parentFilePath) {\n      filesProcessed.push(parentFilePath);\n    }\n    while ((cap = options.includeRe.exec(src))) {\n      let space = cap[1];\n      let includePath = cap[2].trim();\n      filePath = path.resolve(rootdir, includePath);\n\n      // check if child file exists or if there is a circular reference\n      if (!fs.existsSync(filePath)) {\n        // child file does not exist\n        errorMessage = options.notFoundMessage.replace('{{FILE}}', filePath);\n      } else if (filesProcessed.indexOf(filePath) !== -1) {\n        // reference would be circular\n        errorMessage = options.circularMessage\n          .replace('{{FILE}}', filePath)\n          .replace('{{PARENT}}', parentFilePath);\n      }\n\n      // check if there were any errors\n      if (errorMessage) {\n        if (options.throwError) {\n          throw new Error(errorMessage);\n        }\n        mdSrc = `\\n\\n# INCLUDE ERROR: ${errorMessage}\\n\\n`;\n      } else {\n        // get content of child file\n        mdSrc = fs.readFileSync(filePath, 'utf8').trim();\n        if (space) {\n          mdSrc = mdSrc\n            .split('\\n')\n            .map((x, pos) => space + x)\n            .join('\\n');\n        }\n        // check if child file also has includes\n        mdSrc =\n          '\\n' +\n          _replaceIncludeByContent(\n            mdSrc,\n            path.dirname(filePath),\n            filePath,\n            filesProcessed\n          );\n        // remove one trailing newline, if it exists: that way, the included content does NOT\n        // automatically terminate the paragraph it is in due to the writer of the included\n        // part having terminated the content with a newline.\n        // However, when that snippet writer terminated with TWO (or more) newlines, these, minus one,\n        // will be merged with the newline after the #include statement, resulting in a 2-NL paragraph\n        // termination.\n      }\n\n      // replace include by file content\n      src =\n        src.slice(0, cap.index) +\n        mdSrc +\n        src.slice(cap.index + cap[0].length, src.length);\n    }\n    return src;\n  };\n\n  const _includeFileParts = (state, startLine, endLine /*, silent*/) => {\n    state.src = _replaceIncludeByContent(\n      state.src,\n      options.getRootDir(options, state, startLine, endLine)\n    );\n  };\n\n  md.core.ruler.before('normalize', 'include', _includeFileParts);\n};\n\nmodule.exports = include_plugin;\n"],"names":["path","require","fs","INCLUDE_RE","include_plugin","md","options","defaultOptions","root","getRootDir","pluginOptions","includeRe","throwError","bracesAreOptional","notFoundMessage","circularMessage","_replaceIncludeByContent","src","rootdir","parentFilePath","filesProcessed","slice","cap","filePath","mdSrc","errorMessage","push","exec","space","includePath","trim","resolve","existsSync","replace","indexOf","Error","readFileSync","split","map","x","pos","join","dirname","index","length","_includeFileParts","state","startLine","endLine","core","ruler","before","module","exports"],"mappings":"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"}